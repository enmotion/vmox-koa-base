/**
 * @ Author: Your name
 * @ Create Time: 2025-04-15 18:06:29
 * @ Modified by: Your name
 * @ Modified time: 2025-04-16 18:15:28
 * @ Description:
 */
// å¼•å…¥ dotenv æ¨¡å—ï¼Œç”¨äºåŠ è½½ç¯å¢ƒå˜é‡æ–‡ä»¶
const colors = require('colors');
const dotenv = require('dotenv');
// å¼•å…¥ path æ¨¡å—ï¼Œç”¨äºå¤„ç†æ–‡ä»¶è·¯å¾„
const path = require('path');

/**
 * ä½¿ç”¨ dotenv åŠ è½½æŒ‡å®šè·¯å¾„çš„ç¯å¢ƒå˜é‡æ–‡ä»¶ã€‚
 * åŠ è½½åï¼Œæ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡å°†è¢«æ·»åŠ åˆ° process.env å¯¹è±¡ä¸­ã€‚
 */
const result = dotenv.config({ path: path.resolve(__dirname, `./dist/.env`) });
// æ‰“å°ä¸€æ¡ç”± 50 ä¸ªç­‰å·ç»„æˆçš„çº¢è‰²åˆ†éš”çº¿ï¼Œç”¨äºåœ¨æ§åˆ¶å°ä¸­åˆ†éš”é”™è¯¯ä¿¡æ¯å—ï¼Œå¢å¼ºå¯è¯»æ€§
console.log(colors.gray('='.repeat(50)));
if (result.error) {
  console.log(colors.red.bold('âŒ ç¯å¢ƒå˜é‡ä¿¡æ¯æ–‡ä»¶è¯»å–å¤±è´¥'));
  console.log(colors.red(`é”™è¯¯è¯¦æƒ…: ${result.error}`));
  console.log(colors.red('='.repeat(50)));
}else{
  console.log(colors.gray('-'.repeat(50)));
  console.log(colors.blue.bold(`ğŸš€ å¯åŠ¨ç¯å¢ƒå˜é‡:`));
  for(let k in result.parsed){
    console.log(`${colors.white.bold(`${k}:`)}${colors.green(`${result.parsed[k]}`)}`);
  }
  console.log(colors.gray('-'.repeat(50)));
}
/**
 * å¯¼å‡º PM2 çš„é…ç½®å¯¹è±¡ã€‚
 * PM2 æ˜¯ä¸€ä¸ªè¿›ç¨‹ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç† Node.js åº”ç”¨ç¨‹åºçš„è¿è¡Œã€‚
 */
module.exports = {
  apps: [
    {
      /**
       * åº”ç”¨ç¨‹åºçš„åç§°ã€‚
       * å°è¯•ä» process.env ä¸­è·å– NAME çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ 'koa'ã€‚
       * è¿™æ ·å¯ä»¥æ ¹æ®ç¯å¢ƒå˜é‡åŠ¨æ€è®¾ç½®åº”ç”¨åç§°ï¼Œæé«˜é…ç½®çš„çµæ´»æ€§ã€‚
       */
      name: process.env.NAME ?? 'koa',
      /**
       * åº”ç”¨ç¨‹åºçš„å…¥å£è„šæœ¬è·¯å¾„ã€‚
       * è¿™é‡ŒæŒ‡å®šä¸º ./dist/.bin/www.jsï¼Œè¡¨ç¤º PM2 å°†å¯åŠ¨è¯¥è„šæœ¬ä½œä¸ºåº”ç”¨ç¨‹åºçš„å…¥å£ã€‚
       */
      script: './dist/.bin/www.js',
      /**
       * åº”ç”¨ç¨‹åºçš„å®ä¾‹æ•°é‡ã€‚
       * è®¾ç½®ä¸º 1 è¡¨ç¤ºåªå¯åŠ¨ä¸€ä¸ªå®ä¾‹ã€‚
       */
      instances: 1,
      /**
       * æ˜¯å¦è‡ªåŠ¨é‡å¯åº”ç”¨ç¨‹åºã€‚
       * è®¾ç½®ä¸º true è¡¨ç¤ºå½“åº”ç”¨ç¨‹åºå´©æºƒæˆ–é€€å‡ºæ—¶ï¼ŒPM2 ä¼šè‡ªåŠ¨é‡å¯å®ƒã€‚
       */
      autorestart: true,
      /**
       * æ˜¯å¦ç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨é‡å¯åº”ç”¨ç¨‹åºã€‚
       * è®¾ç½®ä¸º true è¡¨ç¤ºå½“åº”ç”¨ç¨‹åºçš„æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒPM2 ä¼šè‡ªåŠ¨é‡å¯åº”ç”¨ã€‚
       */
      watch: true,
      /**
       * åº”ç”¨ç¨‹åºçš„ç¯å¢ƒå˜é‡é…ç½®ã€‚
       * åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ï¼Œå¯ä»¥è®¾ç½®åº”ç”¨ç¨‹åºè¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡ã€‚
       */
      env: {
        /**
         * è®¾ç½® NODE_ENV ç¯å¢ƒå˜é‡ä¸º 'production'ã€‚
         * è¿™æœ‰åŠ©äºåº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶æ ¹æ®ç¯å¢ƒæ¨¡å¼åšå‡ºä¸åŒçš„è¡Œä¸ºã€‚
         */
        NODE_ENV: 'production',
        /**
         * è®¾ç½®åº”ç”¨ç¨‹åºçš„ç«¯å£å·ã€‚
         * å°è¯•ä» process.env ä¸­è·å– PORT çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ 3000ã€‚
         * è¿™æ ·å¯ä»¥æ ¹æ®ç¯å¢ƒå˜é‡åŠ¨æ€è®¾ç½®åº”ç”¨ç¨‹åºçš„ç«¯å£å·ã€‚
         */
        PORT: process.env.PORT ?? 3000
      }
    }
  ]
};