# 作文常见问题集数据模块 PRD

## 1. 模块概述

### 1.1 目标
设计一个完整的作文常见问题集数据管理系统，用于收集、整理和管理小学作文中孩子常见的问题，为AI进行问题判断提供高质量的训练数据支持。

### 1.2 核心概念
- **问题集（Problem Set）**: 作文常见问题的集合，每个问题包含完整的定义、范例和修改指导
- **训练数据（Training Data）**: 用于AI模型训练的问题-答案对
- **难度等级（Difficulty Level）**: 问题的复杂程度分级
- **学龄等级（Grade Level）**: 适用的小学年级范围
- **修改核心（Core Fix）**: 问题的核心修改要点

### 1.3 数据层级关系
```
问题集（Problem）
├── 基础信息（标题、定义、范例）
├── 修改指导（修改核心）
├── 分类信息（难度等级、学龄等级）
├── 权限控制（super等级）
├── 训练数据（问答对）
└── 状态管理（status）
```

## 2. 数据表设计

### 2.1 问题集表（Problem）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| _id | ObjectId | 主键 | 自动生成的唯一标识 |
| title | String | 必填，唯一索引 | 问题标题 |
| definition | String | 必填 | 问题定义 |
| example | String | 必填 | 问题范例 |
| coreFix | String | 必填 | 修改核心 |
| difficultyLevel | Number | 必填 | 难度等级（1-5） |
| gradeLevel | Number | 必填 | 学龄等级（1-6） |
| super | Number | 必填，默认0 | 操作权限等级 |
| trainingData | Array | 可选 | 训练数据数组 |
| status | Boolean | 必填，默认true | 状态标识 |
| createdAt | Date | 自动生成 | 创建时间 |
| updatedAt | Date | 自动更新 | 更新时间 |

### 2.2 训练数据子文档结构
```javascript
{
  q: String,  // 问题
  a: String   // 答案
}
```

## 3. 索引设计

### 3.1 问题集表索引
| 索引名 | 字段 | 类型 | 说明 |
|--------|------|------|------|
| idx_problem_title | title | 唯一索引 | 问题标题索引 |
| idx_problem_difficulty | difficultyLevel | 普通索引 | 难度等级索引 |
| idx_problem_grade | gradeLevel | 普通索引 | 学龄等级索引 |
| idx_problem_super | super | 普通索引 | 权限等级索引 |
| idx_problem_status | status | 普通索引 | 状态索引 |
| idx_problem_compound | (difficultyLevel, gradeLevel, status) | 复合索引 | 复合查询索引 |

## 4. 业务规则

### 4.1 问题集规则
- 问题标题必须全局唯一
- 问题定义必须详细描述问题的特征和表现
- 问题范例必须提供具体的错误示例
- 修改核心必须明确指出修改的关键点
- 难度等级范围为1-5，1为最简单，5为最复杂
- 学龄等级范围为1-6，对应小学一年级到六年级
- 权限等级super默认为0，数值越大权限越高

### 4.2 训练数据规则
- 训练数据为可选字段，可以为空数组
- 每个训练数据项必须包含问题和答案
- 问题应该具有代表性，答案应该准确
- 训练数据数量建议控制在合理范围内（建议不超过50条）

### 4.3 状态管理规则
- status字段控制问题的启用/禁用状态
- 只有启用状态的问题才能被AI系统使用
- 删除操作建议使用软删除（设置status为false）

### 4.4 权限控制规则
- super字段控制数据的操作权限
- 不同权限等级的用户可以操作不同范围的数据
- 高权限用户可以操作低权限数据，反之不可

## 5. 应用场景

### 5.1 AI训练数据收集
- 收集小学作文中的常见问题
- 为AI模型提供高质量的训练数据
- 支持问题的分类和分级管理

### 5.2 作文教学辅助
- 为教师提供问题识别参考
- 帮助学生了解常见问题类型
- 提供修改指导和建议

### 5.3 智能批改系统
- 为智能作文批改系统提供问题库
- 支持自动问题识别和标注
- 提供修改建议和指导

### 5.4 数据分析应用
- 分析不同年级的常见问题分布
- 统计问题难度和频率
- 为教学改进提供数据支持

## 6. API接口设计

### 6.1 基础CRUD接口

#### 6.1.1 创建问题
- **接口**: `POST /problems/`
- **描述**: 创建新的问题集数据
- **权限**: super >= 1

#### 6.1.2 获取问题列表
- **接口**: `POST /problems/list`
- **描述**: 获取问题集列表（支持分页、筛选）
- **权限**: super >= 0

#### 6.1.3 获取问题详情
- **接口**: `GET /problems/:id`
- **描述**: 获取单个问题的详细信息
- **权限**: super >= 0

#### 6.1.4 更新问题
- **接口**: `PUT /problems/:id`
- **描述**: 更新问题集数据
- **权限**: super >= 2

#### 6.1.5 删除问题
- **接口**: `DELETE /problems/:id`
- **描述**: 删除问题集数据（软删除）
- **权限**: super >= 3

### 6.2 扩展功能接口

#### 6.2.1 批量导入
- **接口**: `POST /problems/batch-import`
- **描述**: 批量导入问题集数据
- **权限**: super >= 3

#### 6.2.2 数据导出
- **接口**: `GET /problems/export`
- **描述**: 导出问题集数据
- **权限**: super >= 2

#### 6.2.3 统计分析
- **接口**: `POST /problems/statistics`
- **描述**: 获取问题集统计分析数据
- **权限**: super >= 1

## 7. 数据验证规则

### 7.1 字段验证
- title: 长度1-200字符，不能为空
- definition: 长度10-2000字符，不能为空
- example: 长度10-5000字符，不能为空
- coreFix: 长度10-1000字符，不能为空
- difficultyLevel: 整数1-5
- gradeLevel: 整数1-6
- super: 整数0-10，默认0
- trainingData: 数组，每个元素包含q和a字段

### 7.2 业务验证
- 问题标题必须唯一
- 训练数据中的问题和答案不能为空
- 权限等级必须符合用户权限范围
- 状态变更需要记录操作日志

## 8. 性能优化策略

### 8.1 数据库优化
- 创建合适的索引提高查询性能
- 使用复合索引优化多条件查询
- 实现分页查询避免大数据量问题
- 使用投影查询减少数据传输量

### 8.2 缓存策略
- 缓存热门问题数据
- 缓存按难度和学龄分类的问题列表
- 缓存统计分析结果
- 实现缓存失效机制

### 8.3 查询优化
- 使用聚合管道进行复杂查询
- 实现全文搜索功能
- 优化大数据量查询性能
- 使用索引覆盖查询

## 9. 安全考虑

### 9.1 权限控制
- 实现基于super字段的权限控制
- 限制用户操作权限范围内的数据
- 记录所有数据操作日志
- 实现操作审计功能

### 9.2 数据安全
- 防止SQL注入攻击
- 实现输入数据验证和过滤
- 保护敏感数据不被泄露
- 实现数据备份和恢复机制

### 9.3 接口安全
- 实现接口访问频率限制
- 验证请求参数合法性
- 防止恶意数据提交
- 实现接口签名验证

## 13. 总结

作文常见问题集数据模块是一个专门为AI作文批改系统设计的数据管理模块，通过系统化的数据收集、分类和管理，为AI模型提供高质量的训练数据支持。模块采用分层架构设计，具有良好的可扩展性和维护性，能够满足不同规模的应用需求。

该模块可以作为智能教育系统的核心组件，为作文教学、智能批改、学习分析等应用提供强大的数据支持能力。
